---
title: Unix并发编程
categories: [System]
tags: [C, Unix]
---

### 并发程序

现代操作系统提供了三种基本的构造并发程序的方法:

1. 进程
2. I/O多路复用
3. 线程

### 进程

### I/O多路复用

### 基于线程的并发编程

线程(thread)就是运行在进程上下文中的逻辑流，线程由内核自动调度。每个线程都有它自己的线程上下文(thread context)，包括一个唯一的整数线程ID(Thread ID, TID)、栈、栈指针、通用目的寄存器和条件码。所有运行在一个进程里的线程共享该进程的整个虚拟地址空间。

#### 线程执行模型

每个进程开始生命周期都是单元线程，这个线程称为主线程(main thread)，在某一时刻，主线程创建一个对等线程(peer thread)，从这个时间点开始，两个线程就并发地运行。最后，因为主线程执行一个慢速系统调用，例如read或sleep，或者因为它被系统的间隔计时器中断，控制就会通过上下文切换传递到对等线程。对等线程会执行一段时间，然后传递会主线程，依此类推。

和一个进程相关的线程组成一个对等(线程)池(pool)，独立于其他***(进程/线程)***创建的线程。主线程和其他线程的区别仅仅在于它总是进程中第一个运行的线程。对等(线程)池概念的主要影响是，一个线程可以杀死它的任何对等线程，或者等待它的任意对等线程终止。另外，每个对等线程都能读写相同的共享数据。

#### Posix线程

Posix线程(Pthreads)是C程序中处理线程的一个标准接口。Pthreads定义了大约60个函数，允许程序创建、杀死和回收线程，与对等线程安全地共享数据，还可以通知对等线程系统状态的变化。

线程通过调用pthread_create函数来创建其他线程:

``` c
#include <pthread.h>
typedef void *(func)(void *);

// 成功返回0，出错返回非零
int pthread_create(pthread_t *tid, pthread_attr_t *attr, func *f, void *arg);
```
